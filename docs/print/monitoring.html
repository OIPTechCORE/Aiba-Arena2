<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>monitoring — Aiba Arena Docs</title>
  <link rel="stylesheet" href="../print.css"/>
</head>
<body>
  <div class="doc-header">
    <h1>monitoring</h1>
    <p class="doc-meta no-print"><a href="index.html">← All docs</a></p>
  </div>
  <div class="doc-body">
<h1>Monitoring &amp; Alerting (baseline)</h1>
<p>This repo is instrumented primarily via logs. For production, add:</p>
<ul>
<li>Uptime checks for backend <code>/health</code></li>
<li>Prometheus scraping for backend <code>/metrics</code></li>
<li>TON provider error-rate monitoring (<code>TON_PROVIDER_URL</code> / <code>TON_API_KEY</code>)</li>
</ul>
<h2>Suggested alerts</h2>
<ul>
<li><strong>Economy ledger anomalies</strong>: spikes in NEUR debits/credits or AIBA burns</li>
<li><strong>Vault low inventory</strong>: <code>jettonBalance</code> below threshold</li>
<li><strong>Vault low TON</strong>: <code>tonBalanceNano</code> below threshold for gas</li>
<li><strong>Mongo connection issues</strong>: backend startup failures, reconnection loops</li>
</ul>
<h3>Suggested alerts (Prometheus metrics)- <strong>Battle errors</strong>: <code>rate(aiba_battle_runs_total{result=&quot;error&quot;}[5m])</code> above baseline</h3>
<ul>
<li><strong>Auto-ban spikes</strong>: <code>rate(aiba_auto_bans_total{entity=~&quot;user|broker&quot;}[15m])</code> spikes</li>
<li><strong>Emission denials</strong>: <code>rate(aiba_economy_emissions_total{result!=&quot;ok&quot;}[10m])</code> spikes (labels: <code>currency</code>, <code>arena</code>, <code>league</code>)</li>
<li><strong>Sink spikes</strong>: <code>rate(aiba_economy_sinks_total[10m])</code> spikes (labels: <code>currency</code>, <code>reason</code>)</li>
<li><strong>Withdrawal failures</strong>: <code>rate(aiba_economy_withdrawals_total{result!=&quot;ok&quot;}[10m])</code> above baseline## Metrics endpoint- <strong>Backend</strong>: <code>GET /metrics</code> (Prometheus format)</li>
<li>Includes:</li>
<li>- Default Node.js/process metrics (prefixed <code>aiba_...</code>)</li>
<li>- HTTP request duration histogram: <code>aiba_http_request_duration_seconds</code></li>
<li>- Battle counters:</li>
<li>- <code>aiba_battle_runs_total</code></li>
<li>- <code>aiba_battle_anomalies_total</code></li>
<li>- <code>aiba_auto_bans_total</code></li>
<li>- Economy counters:</li>
<li>- <code>aiba_economy_emissions_total</code></li>
<li>- <code>aiba_economy_sinks_total</code></li>
<li>- <code>aiba_economy_withdrawals_total</code></li>
</ul>
  </div>
</body>
</html>