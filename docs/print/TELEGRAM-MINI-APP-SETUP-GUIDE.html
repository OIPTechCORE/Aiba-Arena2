<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>TELEGRAM MINI APP SETUP GUIDE — Aiba Arena Docs</title>
  <link rel="stylesheet" href="../print.css"/>
</head>
<body>
  <div class="doc-header">
    <h1>TELEGRAM MINI APP SETUP GUIDE</h1>
    <p class="doc-meta no-print"><a href="index.html">← All docs</a></p>
  </div>
  <div class="doc-body">
<h1>How to Create and Set Up a Telegram Mini App — Deep Systematic Guide</h1>
<p>This guide walks you through creating and configuring a <strong>Telegram Mini App</strong> from scratch, with your <strong>AIBA Arena</strong> miniapp as reference. Follow the steps in order.</p>
<hr/>
<h2>1. What Is a Telegram Mini App?</h2>
<ul>
<li>Users open it via a <strong>bot menu button</strong>, <strong>inline button</strong>, or <strong>direct link</strong>.</li>
<li>Telegram injects the <strong>Web App SDK</strong> (<code>window.Telegram.WebApp</code>) and passes <strong>initData</strong> (signed user/session data) so your backend can authenticate the user.</li>
<li><strong>HTTPS is required</strong> for the app URL (no localhost in production).</li>
</ul>
<p><strong>Official docs:</strong> <a href="https://core.telegram.org/bots/webapps">Telegram Mini Apps</a></p>
<hr/>
<h2>2. Prerequisites (Checklist)</h2>
<table>
<thead><tr>
<th>Item</th>
<th>Purpose</th>
</tr></thead>
<tbody>
<tr>
<td><strong>Telegram account</strong></td>
<td>To create the bot and test the app</td>
</tr>
<tr>
<td><strong>A bot</strong></td>
<td>Created via <a href="https://t.me/BotFather">@BotFather</a>; the Mini App is attached to this bot</td>
</tr>
<tr>
<td><strong>Web app URL</strong></td>
<td>Your app must be served over <strong>HTTPS</strong> (e.g. Vercel, Netlify, your server)</td>
</tr>
<tr>
<td><strong>Backend (optional)</strong></td>
<td>To verify <code>initData</code> and store user data (your project uses Express + MongoDB)</td>
</tr>
</tbody></table>
<hr/>
<h2>3. Step-by-Step Setup</h2>
<h3>Step 1 — Create a Telegram Bot</h3>
<ol>
<li>Send: <code>/newbot</code></li>
<li>Follow the prompts:</li>
<li>- <strong>Bot name</strong> (e.g. &quot;AIBA Arena&quot;)</li>
<li>- <strong>Bot username</strong> (e.g. <code>AibaArenaBot</code> — must end in <code>bot</code>)</li>
<li>BotFather replies with a <strong>token</strong> like <code>123456789:AAH...</code>. <strong>Store it securely</strong> (e.g. in <code>backend/.env</code> as <code>TELEGRAM_BOT_TOKEN</code>). Never commit the token to git.</li>
</ol>
<p><strong>Useful BotFather commands later:</strong></p>
<ul>
<li><strong>Edit Bot</strong> → change name, description, photo</li>
<li><strong>Menu Button</strong> or <strong>Configure</strong> → set the Mini App URL (see Step 4)</li>
</ul>
<hr/>
<h3>Step 2 — Build Your Web App</h3>
<p>Your app is a normal web app; the only Telegram-specific parts are:</p>
<ol>
</ol>
<p>When opened inside Telegram, the Telegram client injects a script and sets <code>window.Telegram.WebApp</code>. You don’t need to add the script yourself; just use the API.</p>
<ol>
<li>- <strong>initData</strong> — signed string (user id, username, auth date, etc.). Send it to your backend in a header (e.g. <code>x-telegram-init-data</code>) so the backend can verify the user.</li>
<li>- <strong>initDataUnsafe</strong> — same data as JSON (convenient for UI); <strong>do not trust it on the server</strong> — always verify using <code>initData</code> on the backend.</li>
<li>- <strong>themeParams</strong>, <strong>viewport</strong>, <strong>MainButton</strong>, <strong>BackButton</strong>, <strong>openLink</strong>, <strong>close</strong> — for look-and-feel and UX inside Telegram.</li>
</ol>
<p><strong>In your AIBA Arena miniapp:</strong></p>
<ul>
<li><code>miniapp/src/lib/api.js</code> — sends <code>x-telegram-init-data</code> (and optional <code>x-telegram-id</code> for dev) on every request.</li>
<li>Backend validates <code>initData</code> (e.g. with <code>TELEGRAM_BOT_TOKEN</code>) before trusting the user.</li>
</ul>
<p><strong>Minimal client usage:</strong></p>
<pre><code>// Get initData string (send to backend for verification)
const initData = window.Telegram?.WebApp?.initData || '';
// Get user for display only (never trust on server)
const user = window.Telegram?.WebApp?.initDataUnsafe?.user;
// user.id, user.first_name, user.username, etc.
// Expand to full height (recommended)
window.Telegram?.WebApp?.expand();
// Ready event (optional)
window.Telegram?.WebApp?.ready();</code></pre>
<hr/>
<h3>Step 3 — Host Your App (HTTPS)</h3>
<p>Telegram requires <strong>HTTPS</strong> for the Mini App URL (except for local testing with a tunnel).</p>
<p><strong>Options:</strong></p>
<table>
<thead><tr>
<th>Option</th>
<th>Typical use</th>
</tr></thead>
<tbody>
<tr>
<td><strong>Vercel</strong></td>
<td>Next.js (your miniapp). Connect GitHub repo, set build command and output, add env (e.g. <code>NEXT_PUBLIC_BACKEND_URL</code>). You get <code>https://your-app.vercel.app</code>.</td>
</tr>
<tr>
<td><strong>Netlify</strong></td>
<td>Similar: connect repo, build Next.js or static site.</td>
</tr>
<tr>
<td><strong>Your server</strong></td>
<td>Serve the built app (e.g. <code>miniapp/out</code> for static export or Node with <code>next start</code>) behind HTTPS (nginx + Let’s Encrypt or similar).</td>
</tr>
</tbody></table>
<p><strong>For AIBA Arena:</strong></p>
<ul>
<li>Set <code>NEXT_PUBLIC_BACKEND_URL</code> to your backend API URL (e.g. <code>https://your-backend.onrender.com</code>).</li>
<li>Deploy the miniapp (e.g. Vercel) and note the <strong>root URL</strong> (e.g. <code>https://aiba-arena2-miniapp.vercel.app</code>). This will be the <strong>Mini App URL</strong> in Telegram.</li>
</ul>
<hr/>
<h3>Step 4 — Attach the Mini App to Your Bot</h3>
<p>You must tell Telegram which URL to open when users tap the bot’s menu or a “Open App” button.</p>
<p><strong>Option A — Menu button (recommended)</strong></p>
<ol>
<li>Send <code>/mybots</code> → choose your bot.</li>
<li><strong>Bot Settings</strong> → <strong>Menu Button</strong> → <strong>Configure menu button</strong> (or <strong>Configure</strong> → <strong>Menu Button</strong>).</li>
<li>Set:</li>
<li>- <strong>Menu button URL:</strong> your app URL, e.g. <code>https://aiba-arena2-miniapp.vercel.app</code></li>
<li>- Optionally set <strong>Menu button text</strong> (e.g. &quot;Play&quot; or &quot;Open Arena&quot;).</li>
</ol>
<p>When users open the bot, they’ll see a menu button that opens your Mini App.</p>
<p><strong>Option B — Set via Bot API</strong></p>
<p>You can set the menu button programmatically:</p>
<pre><code>POST https://api.telegram.org/bot&lt;TOKEN&gt;/setChatMenuButton
Content-Type: application/json
{
  &quot;menu_button&quot;: {
    &quot;type&quot;: &quot;web_app&quot;,
    &quot;text&quot;: &quot;Open Arena&quot;,
    &quot;web_app&quot;: { &quot;url&quot;: &quot;https://your-miniapp.vercel.app&quot; }
  }
}</code></pre>
<p>Replace <code>&lt;TOKEN&gt;</code> and the URL. This sets the menu button for the bot.</p>
<p><strong>Option C — Inline / In-chat link</strong></p>
<p>You can open the Mini App from any link that points to your app URL, or from an inline button that uses <code>web_app</code> (see <a href="https://core.telegram.org/bots/api#webappinfo">Telegram Bot API: WebAppInfo</a>).</p>
<hr/>
<h3>Step 5 — Backend: Verify initData (Security)</h3>
<p><strong>Never trust data only from the client.</strong> Always verify <code>initData</code> on the server.</p>
<ol>
<li>Backend:</li>
<li>- Parses the key-value pairs (e.g. <code>hash=...&amp;user=...&amp;auth_date=...</code>).</li>
<li>- Checks <strong>auth_date</strong> is recent (e.g. not older than 5–15 minutes) to prevent replay.</li>
<li>- Builds a <strong>data-check string</strong> and verifies the <strong>hash</strong> using your bot token as HMAC secret (SHA-256).</li>
</ol>
<p><strong>Algorithm (conceptual):</strong></p>
<ul>
<li>Compute <code>HMAC-SHA256(data_check_string, secret)</code> where <code>secret</code> = <code>HMAC-SHA256(bot_token, &quot;WebAppData&quot;)</code>.</li>
<li>Compare result (hex) with the <code>hash</code> from initData.</li>
</ul>
<p>Libraries (e.g. <code>telegram-validate-webapp</code> or similar) often do this for you. Your backend already uses initData for auth (e.g. <code>requireTelegram</code> middleware); ensure it validates the hash and auth_date.</p>
<p><strong>Environment:</strong></p>
<ul>
<li><code>TELEGRAM_INITDATA_MAX_AGE_SECONDS</code> (e.g. 300–900) — reject initData older than this.</li>
</ul>
<hr/>
<h3>Step 6 — Environment Variables Summary</h3>
<p><strong>Miniapp (e.g. Vercel):</strong></p>
<table>
<thead><tr>
<th>Variable</th>
<th>Example</th>
<th>Purpose</th>
</tr></thead>
<tbody>
<tr>
<td><code>NEXT_PUBLIC_BACKEND_URL</code></td>
<td><code>https://your-api.onrender.com</code></td>
<td>API base URL for the miniapp</td>
</tr>
<tr>
<td><code>NEXT_PUBLIC_TONCONNECT_MANIFEST_URL</code></td>
<td>(optional) full URL to TonConnect manifest</td>
<td>If not set, miniapp uses same origin <code>/api/tonconnect-manifest</code></td>
</tr>
</tbody></table>
<p><strong>Backend:</strong></p>
<table>
<thead><tr>
<th>Variable</th>
<th>Purpose</th>
</tr></thead>
<tbody>
<tr>
<td><code>TELEGRAM_BOT_TOKEN</code></td>
<td>Bot token from BotFather; used for initData validation and optional notifications</td>
</tr>
<tr>
<td><code>TELEGRAM_INITDATA_MAX_AGE_SECONDS</code></td>
<td>Max age of initData in seconds (e.g. 300)</td>
</tr>
</tbody></table>
<hr/>
<h3>Step 7 — Test the Flow</h3>
<ol>
</ol>
<p>Run miniapp (<code>npm run dev</code>) and backend locally. Your app may use <code>x-telegram-id</code> for dev when initData is missing; backend should allow that only in dev.</p>
<ol>
<li>- Deploy miniapp to HTTPS (e.g. Vercel).</li>
<li>- Set the bot’s menu button URL to that HTTPS URL.</li>
<li>- Open the bot in Telegram and tap the menu button.</li>
<li>- The Mini App should open; <code>window.Telegram.WebApp</code> and <code>initData</code> will be present.</li>
<li>- Test login/API calls; backend should receive and validate <code>x-telegram-init-data</code>.</li>
</ol>
<ol>
</ol>
<p>For local HTTPS testing inside Telegram, use a tunnel (e.g. ngrok, Cloudflare Tunnel) and temporarily set the menu button URL to the tunnel URL.</p>
<hr/>
<h3>Step 8 — Optional: TonConnect / TON</h3>
<p>If your app uses <strong>TonConnect</strong> (e.g. for wallet connect and claims):</p>
<ul>
<li>In your miniapp, set <code>NEXT_PUBLIC_TONCONNECT_MANIFEST_URL</code> to that full URL if the wallet expects an absolute URL.</li>
<li>Your <code>tonconnect-manifest.json</code> (or dynamic route) should expose <code>url</code>, <code>name</code>, <code>iconUrl</code> for the Mini App.</li>
</ul>
<hr/>
<h2>9. Checklist — Create and Set Up a Mini App</h2>
<ul>
<li>[ ] Build the web app (e.g. Next.js); use <code>window.Telegram.WebApp</code> for initData and UX.</li>
<li>[ ] Deploy the app to an <strong>HTTPS</strong> URL (e.g. Vercel, Netlify).</li>
<li>[ ] Set the bot’s <strong>menu button</strong> (or equivalent) to the app URL.</li>
<li>[ ] Backend: validate <strong>initData</strong> (hash + auth_date) using <code>TELEGRAM_BOT_TOKEN</code>.</li>
<li>[ ] Set <strong>TELEGRAM_INITDATA_MAX_AGE_SECONDS</strong> and use it in validation.</li>
<li>[ ] Configure <strong>NEXT_PUBLIC_BACKEND_URL</strong> (and optional TonConnect manifest URL) for the miniapp.</li>
<li>[ ] Open the bot in Telegram and tap the menu button; confirm the app loads and API calls work with initData.</li>
</ul>
<hr/>
<h2>10. References</h2>
<ul>
<li><a href="https://t.me/BotFather">BotFather</a></li>
<li><a href="https://core.telegram.org/bots/webapps#javascript-api">Telegram WebApp API (JavaScript)</a></li>
<li>Your repo: <code>miniapp/src/lib/telegram.js</code>, <code>miniapp/src/lib/api.js</code>, <code>backend</code> auth/initData validation.</li>
</ul>
<p>This guide gives you a <strong>systematic path</strong>: create bot → build app → host on HTTPS → attach URL to bot → verify initData on backend → test in Telegram.</p>
  </div>
</body>
</html>