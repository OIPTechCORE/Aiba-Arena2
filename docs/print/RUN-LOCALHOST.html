<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>RUN LOCALHOST — Aiba Arena Docs</title>
  <link rel="stylesheet" href="../print.css"/>
</head>
<body>
  <div class="doc-header">
    <h1>RUN LOCALHOST</h1>
    <p class="doc-meta no-print"><a href="index.html">← All docs</a></p>
  </div>
  <div class="doc-body">
<h1>Run Aiba-Arena2 on Localhost</h1>
<p>This guide gets the <strong>backend</strong>, <strong>miniapp</strong>, and <strong>admin panel</strong> running on your machine. Nothing is omitted.</p>
<hr/>
<h2>Prerequisites</h2>
<ul>
<li><strong>npm</strong> (comes with Node). Check: <code>npm -v</code></li>
<li><strong>MongoDB</strong> running locally <strong>or</strong> a MongoDB Atlas connection string.</li>
<li>- Local: install <a href="https://www.mongodb.com/try/download/community">MongoDB Community</a> and start the service, or run <code>mongod</code> so it listens on <code>localhost:27017</code>.</li>
<li>- Atlas: create a free cluster at <a href="https://www.mongodb.com/cloud/atlas">mongodb.com/cloud/atlas</a> and copy the connection string.</li>
</ul>
<hr/>
<h2>1. Backend (API)</h2>
<p>The backend serves the API at <strong>http://localhost:5000</strong>. The miniapp and admin panel call this URL when running locally.</p>
<h3>1.1 Install and configure</h3>
<pre><code>cd backend
npm install</code></pre>
<p>Create <code>backend/.env</code> from the example:</p>
<pre><code># From repo root:
cp backend/.env.example backend/.env</code></pre>
<p>Edit <code>backend/.env</code> and set at least:</p>
<table>
<thead><tr>
<th>Variable</th>
<th>Value for localhost</th>
</tr></thead>
<tbody>
<tr>
<td><strong>MONGO_URI</strong></td>
<td><code>mongodb://localhost:27017/aiba_arena</code> (local) or your Atlas URI (e.g. <code>mongodb+srv://user:pass@cluster.mongodb.net/aiba_arena</code>)</td>
</tr>
<tr>
<td><strong>APP_ENV</strong></td>
<td><code>dev</code> (required for local: skips Telegram initData verification and production checks)</td>
</tr>
<tr>
<td><strong>CORS_ORIGIN</strong></td>
<td>Leave <strong>empty</strong> to allow all origins (localhost:3000, localhost:3001), or set <code>http://localhost:3000,http://localhost:3001</code></td>
</tr>
<tr>
<td><strong>ADMIN_EMAIL</strong></td>
<td>Any email you use to log in to the admin panel (e.g. <code>admin@test.local</code>)</td>
</tr>
<tr>
<td><strong>ADMIN_PASSWORD</strong></td>
<td>Any password (only in dev; backend accepts plaintext when APP_ENV=dev and ADMIN_PASSWORD_HASH is empty)</td>
</tr>
</tbody></table>
<p>Optional for local: <code>ADMIN_JWT_SECRET</code>, <code>BATTLE_SEED_SECRET</code> — if unset, the example defaults may be used in dev (production readiness is skipped when APP_ENV=dev). To test <strong>create broker with TON</strong>, <strong>boost profile</strong>, or <strong>gifts</strong>, set <code>CREATED_BROKERS_WALLET</code>, <code>BOOST_PROFILE_WALLET</code>, and/or <code>GIFTS_WALLET</code> (TON addresses) and configure costs in Admin → Economy (see <a href="MARKETPLACE-AND-PAYMENTS-MASTER-PLAN.md">MARKETPLACE-AND-PAYMENTS-MASTER-PLAN.md</a>).</p>
<h3>1.2 Start the backend</h3>
<pre><code>cd backend
npm start</code></pre>
<p>You should see:</p>
<ul>
<li><code>Server listening</code></li>
</ul>
<p>Check: open <strong>http://localhost:5000/health</strong> in a browser; you should get <code>{&quot;ok&quot;:true}</code>.</p>
<p>Leave this terminal open. Use a <strong>second terminal</strong> for the miniapp.</p>
<hr/>
<h2>2. Miniapp (Telegram Mini App)</h2>
<p>The miniapp runs at <strong>http://localhost:3000</strong> and talks to the backend at http://localhost:5000.</p>
<h3>2.1 Install and configure</h3>
<pre><code>cd miniapp
npm install</code></pre>
<p>Optional: create <code>miniapp/.env.local</code> so the miniapp explicitly uses the local backend (it already defaults to <code>http://localhost:5000</code>):</p>
<pre><code># From repo root:
cp miniapp/.env.local.example miniapp/.env.local</code></pre>
<p><code>miniapp/.env.local</code> should contain:</p>
<pre><code>NEXT_PUBLIC_BACKEND_URL=http://localhost:5000</code></pre>
<h3>2.2 Start the miniapp</h3>
<pre><code>cd miniapp
npm run dev</code></pre>
<p>Open <strong>http://localhost:3000</strong> in your browser.</p>
<p><strong>Local dev auth:</strong> With <code>APP_ENV=dev</code>, the backend accepts the header <code>x-telegram-id</code> instead of Telegram initData. The miniapp sends this when running in the browser (see <code>miniapp/src/lib/api.js</code> and backend <code>requireTelegram</code>). You can use a test id (e.g. the app may send <code>local-dev</code> if no Telegram user is present).</p>
<hr/>
<h2>3. Admin Panel</h2>
<p>The admin panel runs at <strong>http://localhost:3001</strong> and uses the same backend.</p>
<h3>3.1 Install and configure</h3>
<pre><code>cd admin-panel
npm install</code></pre>
<p>Optional: create <code>admin-panel/.env.local</code>:</p>
<pre><code>cp admin-panel/.env.local.example admin-panel/.env.local</code></pre>
<p>Content:</p>
<pre><code>NEXT_PUBLIC_BACKEND_URL=http://localhost:5000</code></pre>
<h3>3.2 Start the admin panel</h3>
<pre><code>cd admin-panel
npm run dev</code></pre>
<p>Open <strong>http://localhost:3001</strong>. Log in with the <strong>ADMIN_EMAIL</strong> and <strong>ADMIN_PASSWORD</strong> you set in <code>backend/.env</code>.</p>
<hr/>
<h2>4. Summary: What runs where</h2>
<table>
<thead><tr>
<th>Service</th>
<th>URL</th>
<th>Command (from its directory)</th>
</tr></thead>
<tbody>
<tr>
<td>Backend</td>
<td>http://localhost:5000</td>
<td><code>npm start</code></td>
</tr>
<tr>
<td>Miniapp</td>
<td>http://localhost:3000</td>
<td><code>npm run dev</code></td>
</tr>
<tr>
<td>Admin panel</td>
<td>http://localhost:3001</td>
<td><code>npm run dev</code></td>
</tr>
</tbody></table>
<p>Order: start <strong>backend first</strong>, then miniapp and admin (in any order).</p>
<hr/>
<h2>5. Run everything from the repo root (optional)</h2>
<p>From the project root you can start all three with one command (requires <code>concurrently</code>):</p>
<pre><code>npm install
npm run dev</code></pre>
<p>This runs:</p>
<ul>
<li>Miniapp on port 3000</li>
<li>Admin panel on port 3001</li>
</ul>
<p>You must still create <code>backend/.env</code> (and optionally <code>miniapp/.env.local</code>, <code>admin-panel/.env.local</code>) before running.</p>
<hr/>
<h2>6. Troubleshooting</h2>
<table>
<thead><tr>
<th>Problem</th>
<th>What to do</th>
</tr></thead>
<tbody>
<tr>
<td>Backend fails with &quot;MONGO_URI not configured&quot;</td>
<td>Create <code>backend/.env</code> from <code>backend/.env.example</code> and set <code>MONGO_URI</code>.</td>
</tr>
<tr>
<td>Backend fails with production readiness errors</td>
<td>Set <code>APP_ENV=dev</code> in <code>backend/.env</code>.</td>
</tr>
<tr>
<td>Miniapp/Admin shows &quot;Backend unreachable&quot; or CORS errors</td>
<td>Ensure backend is running on port 5000; with <code>APP_ENV=dev</code>, CORS allows all origins if <code>CORS_ORIGIN</code> is empty.</td>
</tr>
<tr>
<td>Admin login fails</td>
<td>Set <code>ADMIN_EMAIL</code> and <code>ADMIN_PASSWORD</code> in <code>backend/.env</code> and use those to log in.</td>
</tr>
<tr>
<td>Port already in use</td>
<td>Change port: backend <code>PORT=5001</code> in <code>.env</code> (and set <code>NEXT_PUBLIC_BACKEND_URL=http://localhost:5001</code> in frontends); miniapp <code>npm run dev -- -p 3010</code>; admin <code>npm run dev -- -p 3011</code>.</td>
</tr>
</tbody></table>
<hr/>
<h2>7. Optional: TonConnect and Telegram on localhost</h2>
<ul>
<li><strong>Telegram Mini App:</strong> To test inside the real Telegram Mini App, use a tunnel (e.g. ngrok, localtunnel) to expose http://localhost:3000 via HTTPS and point your Telegram bot’s Mini App URL to that. With <code>APP_ENV=dev</code>, you can still test the app in a normal browser without Telegram.</li>
</ul>
<p>You now have everything needed to run the project on localhost.</p>
  </div>
</body>
</html>